# ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è LiteLLM –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!

**–î–∞—Ç–∞:** $(date '+%Y-%m-%d %H:%M:%S')
**–¶–µ–ª–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä:** 65.21.202.252
**–ú–µ—Ç–æ–¥:** Blue-Green Deployment

---

## üìä –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏

### ‚úÖ –£—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ:

1. **PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
   - –ó–∞–ø–∏—Å–µ–π: 94,464
   - –ü–æ—Ä—Ç: 5434 (–∏–∑–º–µ–Ω—ë–Ω —Å 5433 –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞)
   - –°—Ç–∞—Ç—É—Å: ‚úÖ Healthy

2. **LiteLLM Proxy**
   - –ü–æ—Ä—Ç: 4000
   - –°—Ç–∞—Ç—É—Å: ‚úÖ Healthy
   - API: http://65.21.202.252:4000

3. **Redis**
   - –ü–æ—Ä—Ç: 6381
   - –°—Ç–∞—Ç—É—Å: ‚úÖ Healthy

4. **Prometheus**
   - –ü–æ—Ä—Ç: 9092
   - –°—Ç–∞—Ç—É—Å: ‚úÖ Healthy

5. **Grafana**
   - –ü–æ—Ä—Ç: 3098
   - –°—Ç–∞—Ç—É—Å: ‚úÖ Running
   - URL: http://65.21.202.252:3098
   - –õ–æ–≥–∏–Ω: admin / admin123

6. **Metrics Exporter**
   - –ü–æ—Ä—Ç: 9093 (–∏–∑–º–µ–Ω—ë–Ω —Å 9090 –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞)
   - –°—Ç–∞—Ç—É—Å: ‚úÖ Healthy
   - Metrics: http://65.21.202.252:9093/metrics

---

## ‚öôÔ∏è –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –°—Ç–∞—Ä—ã–π –ø–æ—Ä—Ç | –ù–æ–≤—ã–π –ø–æ—Ä—Ç | –ü—Ä–∏—á–∏–Ω–∞ |
|--------|-------------|------------|---------|
| PostgreSQL | 5433 | 5434 | –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Å–∏—Å—Ç–µ–º–Ω–æ–π PostgreSQL |
| Metrics Exporter | 9090 | 9093 | –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å MinIO |

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ LiteLLM API –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ PostgreSQL —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ 94,464 –∑–∞–ø–∏—Å–∏
- ‚úÖ Grafana –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞—à–±–æ—Ä–¥—ã
- ‚úÖ Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ Metrics Exporter —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥
- ‚úÖ Redis —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª metrics exporter
**–ü—Ä–æ–±–ª–µ–º–∞:** `litellm_simple_working_exporter.py` –Ω–µ –±—ã–ª —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
**–†–µ—à–µ–Ω–∏–µ:** –§–∞–π–ª –∏–∑–≤–ª–µ—á—ë–Ω –∏–∑ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (`litellm_redis_exporter.py`) –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω

### 2. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ PostgreSQL
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Ä—Ç 5433 –∑–∞–Ω—è—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–π PostgreSQL
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω—ë–Ω –Ω–∞ 5434 –≤ `docker-compose.yml`

### 3. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ Metrics Exporter
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Ä—Ç—ã 9090, 9091, 9092 –∑–∞–Ω—è—Ç—ã (MinIO, –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã)
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω—ë–Ω –Ω–∞ 9093 –≤ `docker-compose.yml`

### 4. –û–±–Ω–æ–≤–ª—ë–Ω Prometheus
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª—ë–Ω `prometheus.yml` –¥–ª—è scrape —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ—Ä—Ç–∞ 9090 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –û–±–Ω–æ–≤–∏—Ç–µ DNS –∑–∞–ø–∏—Å–∏

**–ö–†–ò–¢–ò–ß–ù–û:** DNS –µ—â—ë –ù–ï –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä!

–û–±–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ A-–∑–∞–ø–∏—Å–∏:

```
litellm.pro-4.ru  ‚Üí  65.21.202.252
dash.pro-4.ru     ‚Üí  65.21.202.252
```

**–î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** –°–º. [DNS_UPDATE_INSTRUCTIONS.md](DNS_UPDATE_INSTRUCTIONS.md)

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω—ã

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DNS (5-15 –º–∏–Ω—É—Ç):

```bash
# LiteLLM API
curl http://litellm.pro-4.ru:4000/health/liveliness

# Grafana
curl http://dash.pro-4.ru:3098/api/health

# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://dash.pro-4.ru:3098
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

–ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ:

```bash
ssh yan@65.21.202.252
cd /home/yan/litellm
./scripts/setup-cron.sh
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é

```bash
ssh yan@65.21.202.252
cd /home/yan/litellm
./scripts/post-migration-verify.sh
```

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (48 —á–∞—Å–æ–≤)

- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏: `docker compose logs -f`
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ Grafana
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—à–∏–±–æ–∫

### 6. –°—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–µ—Ä

**–ù–ï –£–î–ê–õ–Ø–ô–¢–ï –º–∏–Ω–∏–º—É–º 48 —á–∞—Å–æ–≤!**

- –î–µ—Ä–∂–∏—Ç–µ —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω–Ω—ã–º
- –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞
- –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

---

## üéØ –ö–æ–º–∞–Ω–¥—ã –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ (65.21.202.252):

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh yan@65.21.202.252 "cd litellm && docker compose ps"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
ssh yan@65.21.202.252 "curl http://localhost:4000/health/liveliness"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
ssh yan@65.21.202.252 "docker exec litellm_db psql -U llmproxy -d litellm -c 'SELECT COUNT(*) FROM \"LiteLLM_SpendLogs\"'"

# –õ–æ–≥–∏
ssh yan@65.21.202.252 "cd litellm && docker compose logs --tail=50"

# –ü–æ–ª–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
ssh yan@65.21.202.252 "cd litellm && ./scripts/post-migration-verify.sh"
```

---

## üîÑ –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ù–∞ —Å—Ç–∞—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   cd /home/yan/litellm
   ./scripts/emergency-rollback.sh
   ```

2. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ DNS –æ–±—Ä–∞—Ç–Ω–æ:**
   ```
   litellm.pro-4.ru  ‚Üí  [IP —Å—Ç–∞—Ä–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞]
   dash.pro-4.ru     ‚Üí  [IP —Å—Ç–∞—Ä–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞]
   ```

**–î–µ—Ç–∞–ª–∏:** –°–º. [ROLLBACK_PLAN.md](ROLLBACK_PLAN.md)

---

## üìù –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–∑–º–µ–Ω–µ–Ω—ã:

- `docker-compose.yml` - –ø–æ—Ä—Ç—ã 5434 –∏ 9093
- `prometheus.yml` - targets –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- `litellm_simple_working_exporter.py` - –¥–æ–±–∞–≤–ª–µ–Ω

### –ù–∞ —Å—Ç–∞—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:

- `scripts/migrate-to-new.sh` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
- `scripts/pre-migration-check.sh` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `scripts/post-migration-verify.sh` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `litellm_simple_working_exporter.py` - —Å–æ–∑–¥–∞–Ω –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!

–í—Å–µ 6 —Å–µ—Ä–≤–∏—Å–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ:
- ‚úÖ LiteLLM Proxy
- ‚úÖ PostgreSQL (94,464 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ Redis
- ‚úÖ Prometheus
- ‚úÖ Grafana
- ‚úÖ Metrics Exporter

**–û—Å—Ç–∞–ª–æ—Å—å:** –û–±–Ω–æ–≤–∏—Ç—å DNS –∑–∞–ø–∏—Å–∏!

---

**–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**
- Telegram: `./scripts/telegram-notify.sh "–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"`
- –õ–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏: `/home/yan/litellm/migration_*.log`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [MIGRATION_README.md](MIGRATION_README.md) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [MIGRATION_CHECKLIST.md](MIGRATION_CHECKLIST.md) - –î–µ—Ç–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç
- [DNS_UPDATE_INSTRUCTIONS.md](DNS_UPDATE_INSTRUCTIONS.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ DNS
- [ROLLBACK_PLAN.md](ROLLBACK_PLAN.md) - –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞
